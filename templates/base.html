<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Planificador</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>
    <nav>
        <a href="{{ url_for('complete') }}">Completo</a> |
        <a href="{{ url_for('calendar_view') }}">Calendario</a> |
        <a href="{{ url_for('calendar_pedidos') }}">Calendario pedidos</a> |
        <a href="{{ url_for('project_list') }}">Proyectos</a> |
        <a href="{{ url_for('note_list') }}">Notas</a> |
        <a href="{{ url_for('observation_list') }}">Observaciones</a> |
        <a href="{{ url_for('vacation_list') }}">Vacaciones</a> |
        <a href="{{ url_for('resources') }}">Recursos</a> |
        <a href="{{ url_for('bug_list') }}">Bugs</a> |
        <a href="{{ url_for('add_project') }}">Añadir proyecto</a>
    </nav>
    <hr/>
    {% block content %}{% endblock %}
    <div id="archive-modal" class="conflict-modal">
        <div class="conflict-content">
            <div style="color:orange;font-weight:bold">Borrar el proyecto movido a Ready to Archieve?</div>
            <div style="margin-top:10px;">
                <button id="archive-yes">Sí</button>
                <button id="archive-no">No</button>
            </div>
        </div>
    </div>
    <script>
      const SCROLL_KEY_GENERIC = 'scroll:' + location.pathname;
      const saved = sessionStorage.getItem(SCROLL_KEY_GENERIC);
      if (saved !== null) {
        window.scrollTo(0, parseFloat(saved));
      }
      function storeScroll() {
        sessionStorage.setItem(SCROLL_KEY_GENERIC, window.scrollY);
      }
      window.addEventListener('scroll', storeScroll);
      window.addEventListener('beforeunload', storeScroll);

      const ARCHIVED_PROJECTS = {{ archived_projects|tojson }};
      if (ARCHIVED_PROJECTS.length) {
        const modal = document.getElementById('archive-modal');
        const yesBtn = document.getElementById('archive-yes');
        const noBtn = document.getElementById('archive-no');
        const proj = ARCHIVED_PROJECTS[0];
        modal.style.display = 'flex';
        yesBtn.onclick = async () => {
          await fetch(`/delete_project/${proj.id}`, {method: 'POST'});
          modal.style.display = 'none';
          location.reload();
        };
        noBtn.onclick = async () => {
          await fetch(`/dismiss_archive/${proj.id}`, {method: 'POST'});
          modal.style.display = 'none';
        };
      }
    </script>
</body>
</html>
